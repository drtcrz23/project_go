PubSub Service
Это Go-проект, реализующий gRPC-сервис с шиной событий (Publisher-Subscriber) на основе пакета subpub.
Описание
Проект состоит из двух частей:

Пакет subpub: Шина событий, реализующая паттерн Publisher-Subscriber с поддержкой асинхронной доставки сообщений, FIFO-порядка и независимости подписчиков.
gRPC-сервис: Сервис для подписки на события (streaming RPC) и публикации сообщений (обычный RPC) по ключу.

Возможности

Асинхронная доставка сообщений с сохранением порядка (FIFO).
Поддержка множества подписчиков на один ключ.
Независимость подписчиков: медленный подписчик не блокирует остальных.
Грациозное завершение работы (graceful shutdown).
Логирование всех операций с использованием logrus.
Полное покрытие пакета subpub юнит-тестами, включая проверку медленных подписчиков и работы с контекстом.


Установка
Клонируйте репозиторий:

git clone
cd project_go

Установите зависимости:

go mod tidy

Сгенерируйте gRPC-код:

protoc --go_out=. --go-grpc_out=. proto/pubsub.proto


Настройте конфигурацию:
Скопируйте .env.example в .env:cp .env.example .env


Отредактируйте .env, если нужно изменить порт или уровень логов:GRPC_PORT=:50051
LOG_LEVEL=debug



Запуск

Запустите сервер:

go run cmd/server/main.go

Сервер стартует на порту, указанном в GRPC_PORT (по умолчанию :50051).
Тестирование
Юнит-тесты
Запустите юнит-тесты для пакета subpub:
go test -v ./internal/subpub

Тесты проверяют:

Подписку и отписку нескольких подписчиков.
Сохранение порядка сообщений (FIFO).
Корректное завершение с учётом контекста в методе Close.

Запустите тестовый клиент для проверки подписки и публикации:

go run client/main.go

Клиент подписывается на ключ test, публикует три сообщения и выводит полученные события. Ожидаемый вывод:
2025/05/11 12:00:00 Published: Сообщение 1
2025/05/11 12:00:00 Received event: Сообщение 1
2025/05/11 12:00:01 Published: Сообщение 2
2025/05/11 12:00:01 Received event: Сообщение 2
2025/05/11 12:00:01 Published: Сообщение 3
2025/05/11 12:00:01 Received event: Сообщение 3


Архитектура и паттерны

Dependency Injection: Зависимости (Config, Logger, SubPub) передаются через конструкторы, что упрощает тестирование и замену компонентов.
Graceful Shutdown: Сервер корректно завершает работу при получении сигналов SIGINT/SIGTERM, закрывая gRPC-соединения и подписки.
Single Responsibility: Пакет subpub отвечает за шину событий, gRPC-сервер — за обработку протокола.
Configurability: Настройки задаются через .env или переменные окружения.
Error Handling: Используются gRPC-статус-коды (codes, status) для обработки ошибок.

Конфигурация
Настройки задаются в .env или через переменные окружения:

Логирование
Используется logrus для структурированного логирования. Логируются:
